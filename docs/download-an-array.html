<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Download an Array | Getting Started with BisQue" />
<meta property="og:type" content="book" />

<meta property="og:image" content="images/cover.png" />
<meta property="og:description" content="BisQue (Bio-Image Semantic Query User Environment) : Store, visualize,organize and analyze images in the cloud." />




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="BisQue (Bio-Image Semantic Query User Environment) : Store, visualize,organize and analyze images in the cloud.">

<title>Download an Array | Getting Started with BisQue</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link rel="stylesheet" href="style.css" type="text/css" />

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li class="has-sub"><a href="index.html#cloud-service-module-development-python-api">Cloud Service | Module Development | Python API</a><ul>
<li class="has-sub"><a href="docker-installation.html#docker-installation">Docker Installation</a><ul>
<li><a href="docker-installation.html#intro-bisque-docker-container"><strong>Intro: BisQue Docker Container</strong></a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="1-intro.html#intro"><span class="toc-section-number">1</span> BisQue Cloud Service</a><ul>
<li><a href="1-1-how-to-login-or-create-a-new-user.html#how-to-login-or-create-a-new-user"><span class="toc-section-number">1.1</span> How to Login or Create a New User</a></li>
<li class="has-sub"><a href="1-2-how-to-upload-data.html#how-to-upload-data"><span class="toc-section-number">1.2</span> How to Upload Data</a><ul>
<li><a href="1-2-how-to-upload-data.html#step-1.-login">Step 1. Login</a></li>
<li><a href="1-2-how-to-upload-data.html#step-2.-upload-file-or-folder">Step 2. Upload File or Folder</a></li>
<li><a href="1-2-how-to-upload-data.html#step-3.-build-a-dataset">Step 3. Build a Dataset</a></li>
<li><a href="1-2-how-to-upload-data.html#step-4.-setting-permissions">Step 4. Setting Permissions</a></li>
</ul></li>
<li class="has-sub"><a href="1-3-how-to-add-annotations.html#how-to-add-annotations"><span class="toc-section-number">1.3</span> How to Add Annotations</a><ul>
<li><a href="1-3-how-to-add-annotations.html#overview">Overview</a></li>
</ul></li>
<li><a href="1-4-how-to-run-a-module.html#how-to-run-a-module"><span class="toc-section-number">1.4</span> How to Run a Module</a></li>
<li class="has-sub"><a href="1-5-imagej-module.html#imagej-module"><span class="toc-section-number">1.5</span> ImageJ Module</a><ul>
<li><a href="1-5-imagej-module.html#overview-1">Overview</a></li>
<li><a href="1-5-imagej-module.html#uploading-of-imagej-pipelines">Uploading of ImageJ Pipelines</a></li>
<li><a href="1-5-imagej-module.html#running-an-imagej-macro">Running an ImageJ Macro</a></li>
<li><a href="1-5-imagej-module.html#special-bisque-extensions-for-imagej">Special BisQue extensions for ImageJ</a></li>
</ul></li>
<li class="has-sub"><a href="1-6-cellprofiler-module.html#cellprofiler-module"><span class="toc-section-number">1.6</span> CellProfiler Module</a><ul>
<li><a href="1-6-cellprofiler-module.html#overview-2">Overview</a></li>
<li><a href="1-6-cellprofiler-module.html#uploading-of-cellprofiler-pipelines">Uploading of CellProfiler Pipelines</a></li>
<li><a href="1-6-cellprofiler-module.html#running-a-cellprofiler-pipeline">Running a CellProfiler Pipeline</a></li>
<li><a href="1-6-cellprofiler-module.html#results">Results</a></li>
</ul></li>
<li class="has-sub"><a href="1-7-plant-cell-segmentation.html#plant-cell-segmentation"><span class="toc-section-number">1.7</span> Plant Cell Segmentation</a><ul>
<li><a href="1-7-plant-cell-segmentation.html#overview-3">Overview</a></li>
<li><a href="1-7-plant-cell-segmentation.html#input"><strong><code>Input</code></strong></a></li>
<li><a href="1-7-plant-cell-segmentation.html#hyperparameters">Hyperparameters</a></li>
<li><a href="1-7-plant-cell-segmentation.html#cell-features">Cell Features</a></li>
<li><a href="1-7-plant-cell-segmentation.html#output"><strong><code>Output</code></strong></a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="2-module-development.html#module-development"><span class="toc-section-number">2</span> Module Development</a><ul>
<li><a href="2-module-development.html#how-to-begin-building-modules"><strong>How to Begin Building Modules</strong></a></li>
<li class="has-sub"><a href="2-1-dockerfile.html#dockerfile"><span class="toc-section-number">2.1</span> Dockerfile</a><ul>
<li><a href="2-1-dockerfile.html#example-composite-strength"><strong>Example: Composite Strength</strong></a></li>
</ul></li>
<li class="has-sub"><a href="2-2-module-xml.html#module-xml"><span class="toc-section-number">2.2</span> Module XML</a><ul>
<li><a href="2-2-module-xml.html#example"><strong>Example</strong></a></li>
<li><a href="2-2-module-xml.html#module-description">Module Description</a></li>
<li><a href="2-2-module-xml.html#configurations-for-images-datasets-and-resources">Configurations for Images, Datasets, and Resources</a></li>
<li><a href="2-2-module-xml.html#data-parallel-execution">Data-Parallel Execution</a></li>
</ul></li>
<li class="has-sub"><a href="2-3-python-script-wrapper.html#python-script-wrapper"><span class="toc-section-number">2.3</span> Python Script Wrapper</a><ul>
<li><a href="2-3-python-script-wrapper.html#example.-python-script-wrapper"><em>Example.</em> Python Script Wrapper</a></li>
</ul></li>
<li class="has-sub"><a href="2-4-source-code.html#source-code"><span class="toc-section-number">2.4</span> Source Code</a><ul>
<li><a href="2-4-source-code.html#example.-composite-strength-module"><em>Example.</em> Composite Strength Module</a></li>
</ul></li>
<li class="has-sub"><a href="2-5-runtime-module-configuration.html#runtime-module-configuration"><span class="toc-section-number">2.5</span> Runtime Module Configuration</a><ul>
<li><a href="2-5-runtime-module-configuration.html#example.-composite-strength-module-1"><em>Example.</em> Composite Strength Module</a></li>
</ul></li>
<li><a href="2-6-python-setup.html#python-setup"><span class="toc-section-number">2.6</span> Python Setup</a></li>
</ul></li>
<li class="has-sub"><a href="3-bqapi.html#bqapi"><span class="toc-section-number">3</span> BQAPI</a><ul>
<li class="has-sub"><a href="download-an-array.html#download-an-array"><strong>Download an Array</strong></a><ul>
<li><a href="download-an-array.html#access-an-hdf5-table-from-bisque">Access an HDF5 Table from BisQue</a></li>
</ul></li>
<li><a href="upload-an-image.html#upload-an-image"><strong>Upload an Image</strong></a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="download-an-array" class="section level2 unnumbered">
<h2><strong>Download an Array</strong></h2>
<div id="access-an-hdf5-table-from-bisque" class="section level3 unnumbered">
<h3>Access an HDF5 Table from BisQue</h3>
<p>In this example, we will show you how to use the BQAPI to download a multidimensional array from within an HDF file and return it as a <code>numpy</code> array in <code>Python</code>.</p>
<hr />
<p>The API call goes as follows:</p>
<ol style="list-style-type: decimal">
<li>Get the logger</li>
<li>Instantiate a BisQue session</li>
<li>Login using <code>USERNAME</code> and <code>PASSWORD</code></li>
<li>Instantiate the <code>table</code> service</li>
<li>Use the table service to load the array</li>
<li>Return the array</li>
</ol>
<hr />
<div id="step-0.-import-dependencies" class="section level4 unnumbered">
<h4>Step 0. Import Dependencies</h4>
<p>Before we can even attempt anything cool with the API, we need to import the necessary packages. In this case, we need the following packages:</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb155-1" title="1"><span class="im">import</span> numpy <span class="im">as</span> np</a>
<a class="sourceLine" id="cb155-2" title="2"><span class="im">import</span> logging</a>
<a class="sourceLine" id="cb155-3" title="3"></a>
<a class="sourceLine" id="cb155-4" title="4"><span class="im">from</span> bqapi.services <span class="im">import</span> tables</a>
<a class="sourceLine" id="cb155-5" title="5"><span class="im">from</span> bqapi <span class="im">import</span> BQSession</a>
<a class="sourceLine" id="cb155-6" title="6"><span class="im">from</span> bqapi.util <span class="im">import</span> fetch_blob</a>
<a class="sourceLine" id="cb155-7" title="7"><span class="im">from</span> bqapi.comm <span class="im">import</span> BQCommError</a>
<a class="sourceLine" id="cb155-8" title="8"><span class="im">from</span> bqapi.comm <span class="im">import</span> BQSession</a></code></pre></div>
<p>Place these at the top of your Jupyter notebook or <code>Python</code> script to ensure these run first. If you have not installed the BQAPI via pip, then <a href="3-bqapi.html#pip-install">install the BQAPI here.</a></p>
</div>
<div id="step-1.-get-the-logger" class="section level4 unnumbered">
<h4>STEP 1. Get the Logger</h4>
<p>The logger service allows us to debug if anything goes wrong during the process of pulling our array. We use this in the BisQue core development as well, so feel free to gain greater insight into our other logger services as well.</p>
<p>We will define the <code>get_table</code> logger here.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb156-1" title="1">log <span class="op">=</span> logging.getLogger(<span class="st">&#39;get_table&#39;</span>)</a></code></pre></div>
</div>
<div id="step-2.-instantiate-a-bisque-session" class="section level4 unnumbered">
<h4>STEP 2. Instantiate a BisQue session</h4>
<p>This instantiation enables the user to effectively communicate with BisQue. Without this, you will not be able to login and interact with the API.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb157-1" title="1">bq <span class="op">=</span> BQSession()</a></code></pre></div>
</div>
<div id="step-3.-login-using-bisque-credentials" class="section level4 unnumbered">
<h4>STEP 3. Login using BisQue Credentials</h4>
<p>Here is where we will login into our BisQue account to access the data we have uploaded. We show an alternative chained version (line 2) of the commands here to instantiate the BQSession and login at the same time.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb158-1" title="1">bq.init_local(user, pwd, bisque_root<span class="op">=</span>root)</a>
<a class="sourceLine" id="cb158-2" title="2"><span class="co"># bq = BQSession().init_local(user, pwd, bisque_root=root)</span></a></code></pre></div>
<p><strong>Inputs</strong></p>
<p>If you do not have an account on BisQue, <a href="https://bisque.ece.ucsb.edu/registration//new">make an account here</a>.</p>
<ul>
<li><code>USER</code> BisQue Username</li>
<li><code>PASSWORD</code> BisQue Password</li>
<li><code>bisque_root</code> “<a href="https://bisque.ece.ucsb.edu" class="uri">https://bisque.ece.ucsb.edu</a>”</li>
</ul>
<p><strong>Example.</strong></p>
<div class="sourceCode" id="cb159"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb159-1" title="1">bq.init_local(user<span class="op">=</span>amil_khan, <span class="cf">pass</span><span class="op">=</span>bisque1234,</a>
<a class="sourceLine" id="cb159-2" title="2">              bisque_root<span class="op">=</span><span class="st">&quot;https://bisque.ece.ucsb.edu&quot;</span>)</a></code></pre></div>
</div>
<div id="step-4.-instantiate-the-table-service" class="section level4 unnumbered">
<h4>STEP 4. Instantiate the <code>table</code> service</h4>
<p>Now we need to instantiate the table service. To do this, use <em>service</em> to call the table service. Simple, right?</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb160-1" title="1">table_service <span class="op">=</span> bq.service (<span class="st">&#39;table&#39;</span>)</a></code></pre></div>
</div>
<div id="step-5.-using-the-table-service" class="section level4 unnumbered">
<h4>STEP 5. Using the Table Service</h4>
<p>In this example, we use the <code>load_array</code> function from the table service to return a <code>numpy</code> array from the respective HDF file on BisQue. What is most important is the input to this function, which is as follows:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb161-1" title="1">data_array <span class="op">=</span> table_service.load_array(table_uniq, path, slices<span class="op">=</span>[])</a></code></pre></div>
<p><strong>Inputs</strong></p>
<ul>
<li><code>table_uniq:</code> BisQue URI (<strong>Required</strong>)</li>
<li><code>path      :</code> Path to table within HDF (<strong>Required</strong>)</li>
<li><code>slices    :</code> Slice of an array (<strong>Optional</strong>)</li>
</ul>
<p><strong>What is the <code>table_uniq</code></strong></p>
<p>The <code>table_uniq</code> argument comes from how BisQue handles resources. Let’s say you upload an image of a cat. BisQue will automatically assign a unique ID or, <strong>URI</strong>, to that image. Here is an example image:</p>
<pre><code>https://bisque.ece.ucsb.edu/client_service/view?resource=https://bisque.ece.ucsb.edu/data_service/00-s5b358UmuziTaUqqYtTcPF</code></pre>
<p>The last portion of the url is the URI. This is what you need to use as the input to the <code>table_uniq</code> argument.</p>
<pre><code>https://bisque.ece.ucsb.edu/data_service/00-s5b358UmuziTaUqqYtTcPF
                                         ^-----------------------^
                                              COPY TABLE URI</code></pre>
<p><strong>What is the <code>path</code></strong></p>
<p>Say we have an array stored in a specific path in our HDF file. We can define a variable named <code>table_path</code> and place that after the <code>table_uniq</code> argument.</p>
<p><strong>Example</strong></p>
<div class="sourceCode" id="cb164"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb164-1" title="1">table_path <span class="op">=</span> <span class="st">&#39;PATH/TO/ARRAY/IN/HDF&#39;</span></a>
<a class="sourceLine" id="cb164-2" title="2">table_service.load_array(uri, table_path)</a></code></pre></div>
</div>
<div id="example.-functionalizing-the-boring-stuff-get_table" class="section level4 unnumbered">
<h4>Example. Functionalizing the Boring Stuff: <code>get_table</code></h4>
<p>Here we provide a full working example of how to functionalize the entire process. Overall, the structure is the same as the sum of its pieces, but now we can import many arrays into, say, our Jupyter Notebook for simple data processing tasks. You can also extend this example to upload the table back to BisQue once the data preprocessing is done.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb165-1" title="1"><span class="kw">def</span> get_table(user,pwd, table_PATH, uri<span class="op">=</span><span class="va">None</span>,root<span class="op">=</span><span class="st">&#39;https://bisque.ece.ucsb.edu&#39;</span>):</a>
<a class="sourceLine" id="cb165-2" title="2">    </a>
<a class="sourceLine" id="cb165-3" title="3">    log <span class="op">=</span> logging.getLogger(<span class="st">&#39;get_table&#39;</span>)</a>
<a class="sourceLine" id="cb165-4" title="4">    <span class="bu">print</span>(<span class="st">&quot;Starting Session...&quot;</span>)</a>
<a class="sourceLine" id="cb165-5" title="5">    </a>
<a class="sourceLine" id="cb165-6" title="6">    bq <span class="op">=</span> BQSession().init_local(user, pwd, bisque_root<span class="op">=</span>root)</a>
<a class="sourceLine" id="cb165-7" title="7">    <span class="bu">print</span>(<span class="st">&quot;BQSession Established. Attempting to fetch data...&quot;</span>)</a>
<a class="sourceLine" id="cb165-8" title="8">    </a>
<a class="sourceLine" id="cb165-9" title="9">    table_service <span class="op">=</span> bq.service (<span class="st">&#39;table&#39;</span>)</a>
<a class="sourceLine" id="cb165-10" title="10">    <span class="bu">print</span>(<span class="st">&quot;Successfully Retrieved Array!&quot;</span>)</a>
<a class="sourceLine" id="cb165-11" title="11">    logging.basicConfig()</a>
<a class="sourceLine" id="cb165-12" title="12"></a>
<a class="sourceLine" id="cb165-13" title="13">    </a>
<a class="sourceLine" id="cb165-14" title="14">    <span class="cf">return</span> table_service.load_array(uri, table_PATH)</a></code></pre></div>
<p><strong>Let’s run our function!</strong></p>
<p>In this example, we are using the BQAPI to access an HDF file that contains a two-phase 3D microstructure.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb166-1" title="1">ms <span class="op">=</span> get_table(amil_khan, bisque1234, </a>
<a class="sourceLine" id="cb166-2" title="2">              <span class="st">&#39;DataContainers/ImageDataContainer/CellData/Phases&#39;</span>,</a>
<a class="sourceLine" id="cb166-3" title="3">              <span class="st">&#39;00-orJQLiXgqh8K955C6qzhyC&#39;</span>)</a>
<a class="sourceLine" id="cb166-4" title="4"><span class="bu">print</span>(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">Shape of table: </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(ms.shape))</a></code></pre></div>
<p><strong><code>Output:</code></strong></p>
<pre><code>Starting Session...
BQSession Established. Attempting to fetch data...
Successfully Retrieved Array!

Shape of table: (5, 5, 5, 1)</code></pre>
</div>
</div>
</div>
<p style="text-align: center;">
<a href="3-bqapi.html"><button class="btn btn-default">Previous</button></a>
<a href="upload-an-image.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
